---
title:      ".net5构建RESTFul API"
categories: .NET
date:       2022-01-17 22:13:00
author:     "WenzhongXu"
tags:
    - C#
---

<!-- more -->
根据杨旭老师的[ASP.NET Core 3.x 构建 RESTful API](https://www.bilibili.com/video/BV1XJ411q7yy)学习笔记

## RESTFul API
### REST
REST即Representational State Transfer（状态表述转换）。描述了Web应用到底是怎样的设计才算是优良的。定义了如下三点：
- 一组网页的网络（一个虚拟状态机）
- 在这些网页上，用户可以通过点击链接来前进（状态转换）
- 点击链接的结果就是下一个网页（表示程序的下一个状态）被传输到用户那里，并渲染好给用户使用

REST风格的API是一套约束规范，是一种架构风格。需要使用一些规范、协议或标准来实现。

### REST的优点
- 性能
- 组件交互的可扩展性
- 组件的可修改性
- 可移植性
- 可靠性
- 可视性

### REST的约束
- 客户端-服务器
- 无状态
- 统一的资源接口/界面
- 多层系统
- 可缓存
- 按需编码（可选）


### 对外合约
#### 资源命名
1. 使用名词而非动词
比如接口是为了获得系统里所有的用户，常见错误的做法是 api/getusers。
正确的做法是 GET api/users。

2. 人类能读懂
命名上要足够友好，并且比较简短。

3. 要体现资源的结构/关系
- 假设存在若干种资源，而用户这个资源与其他资源没有直接关系，那么获取用户的url应该是 api/users，而不是api/product/users或者api/files/product/users，因为他们没有直接的结构关系
- 通过id获取单个用户应该是api/users/{userId}，而不是api/userid/users
- 目的是让api具有很好的预测性和一致性

    1. 案例1 获取某个公司下所有员工信息
    - 分析：使用HTTP的GET，url需要体现公司和员工的包含关系
    - 常见错误做法：api/employees,api/employees/{companyId}
    - 建议做法：GET api/companies/{companyId}/employees

    2. 案例2 获取某个公司的某个员工信息
    - 分析：还是需要体现包含关系
    - 常见错误做法：api/companies/{employeeId},api/employees/{employeeId}
    - 建议做法：GET api/companies/{companyId}/employees/{employeeId}

4. 自定义查询的命名
- 假设需要获取所有用户信息，并要求按照年龄从小到大排列
- 常见错误做法： api/users/orderby/age
- 建议做法： GET api/users?orderby=name

5. 例外
有一些需求总是无法满足RESTful的约束，比如获取系统中用户的数量，只能妥协的做法如下：
GET api/users/totalamounttouser